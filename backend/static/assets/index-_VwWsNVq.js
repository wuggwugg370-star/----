(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const B="/api";async function m(e,i={}){const t=await(await fetch(`${B}${e}`,i)).json();if(t.code!==200)throw new Error(t.msg||"Error");return t.data||t}const w=()=>m("/menu"),L=e=>m("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}),x=e=>m("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}),T=e=>m("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function k(){console.log("ğŸš€ ç³»ç»Ÿå¯åŠ¨..."),O(),sessionStorage.getItem("isAdmin")==="true"&&v(),await y()}async function y(){const e=document.getElementById("loading");try{a.menu=await w(),console.log("âœ… èœå•æ•°æ®:",a.menu),b(),g()}catch(i){console.error("âŒ æ•°æ®åŠ è½½å¤±è´¥:",i),e&&(e.innerText="æ— æ³•è¿æ¥æœåŠ¡å™¨"),Object.keys(a.menu).length===0&&alert("è¿æ¥åç«¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Python é»‘çª—å£æ˜¯å¦è¿è¡Œï¼")}finally{e&&(e.style.display="none")}}function b(){const e=new Set(["All"]);Object.values(a.menu).forEach(o=>e.add(o.category||"å…¶ä»–"));const i=document.getElementById("category-bar");i&&(i.innerHTML="",e.forEach(o=>{const t=document.createElement("button");t.className=`cat-btn ${o===a.activeCategory?"active":""}`,t.innerText=o,t.onclick=()=>{a.activeCategory=o,b(),f()},i.appendChild(t)}))}function g(){const e=document.getElementById("menu-grid");if(!e)return;e.innerHTML="";const i=Object.entries(a.menu);if(i.length===0){e.innerHTML='<div style="padding:20px;">æš‚æ— èœå“<br>è¯·ç‚¹å‡»å³ä¸Šè§’æ·»åŠ </div>';return}i.forEach(([o,t])=>{const n=document.createElement("div");n.className="card",n.dataset.name=o,n.dataset.category=t.category||"å…¶ä»–";const c=a.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;padding:5px;cursor:pointer;">âœï¸ ç¼–è¾‘</button>':"",s=t.image&&t.image.startsWith("http")?t.image:"https://via.placeholder.com/300x200?text=No+Image";n.innerHTML=`
      <div class="card-img" style="background-image: url('${s}'); position:relative;">${c}</div>
      <div class="card-content">
        <div class="card-tag">${t.category}</div>
        <div class="card-title">${o}</div>
        <div class="card-price">Â¥${Number(t.price).toFixed(2)}</div>
        <button class="btn add-btn">åŠ å…¥è´­ç‰©è½¦</button>
      </div>
    `;const r=n.querySelector(".add-btn");if(r&&(r.onclick=()=>A(o)),a.isAdmin){const p=n.querySelector(".edit-btn");p&&(p.onclick=I=>{I.stopPropagation(),E(o,t)})}e.appendChild(n)}),f()}function f(){const e=document.getElementById("global-search"),i=document.getElementById("menu-grid");if(!i||!e)return;const o=e.value.toLowerCase().trim();Array.from(i.children).forEach(t=>{if(!t.dataset.name)return;const n=t.dataset.name.toLowerCase(),c=t.dataset.category,s=a.activeCategory==="All"||c===a.activeCategory,r=n.includes(o);t.style.display=s&&r?"flex":"none"})}function A(e){a.cart[e]=(a.cart[e]||0)+1,h()}function h(){const e=document.getElementById("cart-items");if(!e)return;e.innerHTML="";let i=0,o=0;Object.entries(a.cart).forEach(([n,c])=>{const s=a.menu[n];if(s){i+=s.price*c,o+=c;const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;margin-bottom:5px;",r.innerHTML=`<span>${n} x${c}</span> <b>Â¥${(s.price*c).toFixed(2)}</b>`,e.appendChild(r)}}),u("drawer-total-price",`Â¥${i.toFixed(2)}`),u("cart-badge",o);const t=document.getElementById("checkout-btn");t&&(t.disabled=o===0)}function v(){a.isAdmin=!0,d("admin-toolbar","flex"),d("admin-login-btn","none"),sessionStorage.setItem("isAdmin","true"),g()}function C(){a.isAdmin=!1,d("admin-toolbar","none"),d("admin-login-btn","block"),sessionStorage.removeItem("isAdmin"),g()}function E(e="",i={}){d("item-modal","flex"),l("input-name",e);const o=document.getElementById("input-name");o&&(o.disabled=!!e),l("input-price",i.price||""),l("input-category",i.category||""),l("input-image",i.image||""),u("modal-title",e?"ç¼–è¾‘èœå“":"æ·»åŠ æ–°èœå“")}function O(){const e=(t,n,c)=>{const s=document.getElementById(t);s&&s.addEventListener(n,c)};e("admin-login-btn","click",async()=>{const t=prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç  (admin123):");if(t)try{await x(t),v()}catch{alert("å¯†ç é”™è¯¯")}}),e("logout-btn","click",C),e("search-trigger","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.add("active")}),e("close-search","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.remove("active")}),e("global-search","input",f);const i=t=>{const n=document.getElementById("cart-drawer"),c=document.getElementById("drawer-backdrop");t?(n&&n.classList.add("open"),c&&c.classList.add("open")):(n&&n.classList.remove("open"),c&&c.classList.remove("open"))};e("cart-toggle-btn","click",()=>i(!0)),e("close-drawer","click",()=>i(!1)),e("drawer-backdrop","click",()=>i(!1)),e("checkout-btn","click",async()=>{const t=Object.entries(a.cart).flatMap(([c,s])=>Array(s).fill(c));await L(t),a.cart={},h(),toggleDrawer(!1);const n=document.getElementById("success-modal");n&&n.classList.add("show")}),e("success-close-btn","click",()=>{const t=document.getElementById("success-modal");t&&t.classList.remove("show")}),e("add-item-btn","click",()=>E()),e("modal-cancel","click",()=>d("item-modal","none"));const o=document.getElementById("item-form");o&&(o.onsubmit=async t=>{t.preventDefault();const n=o.querySelector('button[type="submit"]');n&&(n.innerText="ä¿å­˜ä¸­...");try{const c={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};await T(c),alert("ğŸ‰ ä¿å­˜æˆåŠŸï¼"),d("item-modal","none"),y()}catch(c){alert(`âŒ ä¿å­˜å¤±è´¥ï¼š
`+c.message)}finally{n&&(n.innerText="ä¿å­˜")}})}function d(e,i){const o=document.getElementById(e);o&&(o.style.display=i)}function u(e,i){const o=document.getElementById(e);o&&(o.innerText=i)}function l(e,i){const o=document.getElementById(e);o&&(o.value=i)}k();
