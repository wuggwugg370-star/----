(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function c(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=c(n);fetch(n.href,i)}})();const B="/api";async function m(e,o={}){const t=await(await fetch(`${B}${e}`,o)).json();if(t.code!==200)throw new Error(t.msg||"Error");return t.data||t}const w=()=>m("/menu"),L=e=>m("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}),x=e=>m("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}),k=e=>m("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function A(){console.log("ğŸš€ ç³»ç»Ÿå¯åŠ¨..."),O(),sessionStorage.getItem("isAdmin")==="true"&&v(),await y()}async function y(){const e=document.getElementById("loading");try{a.menu=await w(),console.log("âœ… èœå•æ•°æ®:",a.menu),b(),g()}catch(o){console.error("âŒ æ•°æ®åŠ è½½å¤±è´¥:",o),e&&(e.innerText="æ— æ³•è¿æ¥æœåŠ¡å™¨"),alert("è¿æ¥åç«¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Python æ˜¯å¦è¿è¡Œï¼")}finally{e&&(e.style.display="none")}}function b(){const e=new Set(["All"]);Object.values(a.menu).forEach(c=>e.add(c.category||"å…¶ä»–"));const o=document.getElementById("category-bar");o&&(o.innerHTML="",e.forEach(c=>{const t=document.createElement("button");t.className=`cat-btn ${c===a.activeCategory?"active":""}`,t.innerText=c,t.onclick=()=>{a.activeCategory=c,b(),f()},o.appendChild(t)}))}function g(){const e=document.getElementById("menu-grid");if(!e)return;e.innerHTML="";const o=Object.entries(a.menu);if(o.length===0){e.innerHTML='<div style="padding:20px;">æš‚æ— èœå“</div>';return}o.forEach(([c,t])=>{const n=document.createElement("div");n.className="card",n.dataset.name=c,n.dataset.category=t.category||"å…¶ä»–";const i=a.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;padding:5px;cursor:pointer;">âœï¸ ç¼–è¾‘</button>':"",s=t.image&&t.image.startsWith("http")?t.image:"https://via.placeholder.com/300x200?text=No+Image";n.innerHTML=`
      <div class="card-img" style="background-image: url('${s}'); position:relative;">${i}</div>
      <div class="card-content">
        <div class="card-tag">${t.category}</div>
        <div class="card-title">${c}</div>
        <div class="card-price">Â¥${Number(t.price).toFixed(2)}</div>
        <button class="btn add-btn">åŠ å…¥è´­ç‰©è½¦</button>
      </div>
    `;const r=n.querySelector(".add-btn");if(r&&(r.onclick=()=>C(c)),a.isAdmin){const p=n.querySelector(".edit-btn");p&&(p.onclick=I=>{I.stopPropagation(),E(c,t)})}e.appendChild(n)}),f()}function f(){const e=document.getElementById("global-search"),o=document.getElementById("menu-grid");if(!o||!e)return;const c=e.value.toLowerCase().trim();Array.from(o.children).forEach(t=>{if(!t.dataset.name)return;const n=t.dataset.name.toLowerCase(),i=t.dataset.category,s=a.activeCategory==="All"||i===a.activeCategory,r=n.includes(c);t.style.display=s&&r?"flex":"none"})}function C(e){a.cart[e]=(a.cart[e]||0)+1,h()}function h(){const e=document.getElementById("cart-items");if(!e)return;e.innerHTML="";let o=0,c=0;Object.entries(a.cart).forEach(([n,i])=>{const s=a.menu[n];if(s){o+=s.price*i,c+=i;const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;margin-bottom:5px;",r.innerHTML=`<span>${n} x${i}</span> <b>Â¥${(s.price*i).toFixed(2)}</b>`,e.appendChild(r)}}),u("drawer-total-price",`Â¥${o.toFixed(2)}`),u("cart-badge",c);const t=document.getElementById("checkout-btn");t&&(t.disabled=c===0)}function v(){a.isAdmin=!0,d("admin-toolbar","flex"),d("admin-login-btn","none"),sessionStorage.setItem("isAdmin","true"),g()}function T(){a.isAdmin=!1,d("admin-toolbar","none"),d("admin-login-btn","block"),sessionStorage.removeItem("isAdmin"),g()}function E(e="",o={}){d("item-modal","flex"),l("input-name",e);const c=document.getElementById("input-name");c&&(c.disabled=!!e),l("input-price",o.price||""),l("input-category",o.category||""),l("input-image",o.image||""),u("modal-title",e?"ç¼–è¾‘èœå“":"æ·»åŠ æ–°èœå“")}function O(){const e=(t,n,i)=>{const s=document.getElementById(t);s?s.addEventListener(n,i):console.warn(`âš ï¸ æœªæ‰¾åˆ°å…ƒç´ : #${t}`)};e("admin-login-btn","click",async()=>{const t=prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç  (admin123):");if(t)try{await x(t),v()}catch{alert("å¯†ç é”™è¯¯")}}),e("logout-btn","click",T),e("search-trigger","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.add("active")}),e("close-search","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.remove("active")}),e("global-search","input",f);const o=t=>{const n=document.getElementById("cart-drawer"),i=document.getElementById("drawer-backdrop");t?(n&&n.classList.add("open"),i&&i.classList.add("open")):(n&&n.classList.remove("open"),i&&i.classList.remove("open"))};e("cart-toggle-btn","click",()=>o(!0)),e("close-drawer","click",()=>o(!1)),e("drawer-backdrop","click",()=>o(!1)),e("checkout-btn","click",async()=>{const t=Object.entries(a.cart).flatMap(([i,s])=>Array(s).fill(i));await L(t),a.cart={},h(),o(!1);const n=document.getElementById("success-modal");n&&n.classList.add("show")}),e("success-close-btn","click",()=>{const t=document.getElementById("success-modal");t&&t.classList.remove("show")}),e("add-item-btn","click",()=>E()),e("modal-cancel","click",()=>d("item-modal","none"));const c=document.getElementById("item-form");c&&(c.onsubmit=async t=>{t.preventDefault();const n={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};await k(n),d("item-modal","none"),y()})}function d(e,o){const c=document.getElementById(e);c&&(c.style.display=o)}function u(e,o){const c=document.getElementById(e);c&&(c.innerText=o)}function l(e,o){const c=document.getElementById(e);c&&(c.value=o)}A();
